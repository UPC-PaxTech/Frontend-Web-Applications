@startuml
skinparam packageStyle rectangle

package "App" {
  class AppComponent <<Component>>{
     +title: string
   }
}

package "Appointments" {

  package "Components" {
    class AppointmentsItemComponent {
      - appointment: ClientAppointment
      + formatDay(dateString: string): string
      + formatTime(dateString: string): string
    }

    class AppointmentsListComponent {
      - appointments: ClientAppointment[]
      - reviews: Review[]
      - appointmentService: AppointmentApiService
      - reviewService: ReviewApiService
      + ngOnInit(): void
      + loadAppointments(): void
      + trackById(index: number, item: ClientAppointment): string
    }

    class UpcomingAppointmentsComponent {
      - upcomingAppointments: ClientAppointment[]
      - appointmentService: AppointmentApiService
      + ngOnInit(): void
      + formatTime(dateStr: string): string
      + formatDay(dateStr: string): string
      + isToday(dateStr: string): boolean
    }

    ' Declaramos ReviewItemComponent y ReviewListComponent solo aquí en appointments.components
    class ReviewItemComponent {
      - review: Review
      + getStars(): number[]
    }

    class ReviewListComponent {
      - reviews: Review[]
    }
  }

  package "Models" {
    entity ClientAppointment {
      - reservationId: string
      - tipo: string
      - clientName: string
      - salonName: string
      - paymentStatus: boolean
      - timeSlotStart: string
      - timeSlotEnd: string
    }
    entity Review {
      - id: number
      - author: string
      - rating: number
      - text: string
      - read: boolean
    }
  }

  package "Pages" {
    class AppointmentMakerComponent {
      - worker: Worker[]
      - selectedReservation: { date: Date, timeSlot: any } | null
      + ngOnInit(): void
      + onReservationConfirmed(event: { date: Date, timeSlot: any }): void
      + bookAppointment(): void
    }
    class ClientAppointmentPagesComponent {
    }
  }

  package "Services" {
    class AppointmentApiService {
      - resourceEndpoint: string = "/reservationDetails"
      + getAppointments(): Observable<ClientAppointment[]>
    }
    class ReviewApiService {
      - resourceEndpoint: string = "/reviews"
      + getReviews(): Observable<Review[]>
    }
    class AppointmentAssembler {
      + toEntityFromResource(resource: AppointmentResponse): ClientAppointment
      + toEntitiesFromResponse(resources: AppointmentResponse[]): ClientAppointment[]
    }
    class ReviewAssembler {
      + toEntityFromResource(resource: ReviewResponse): Review
      + toEntitiesFromResponse(resources: ReviewResponse[]): Review[]
    }
    class AppointmentResponse {
      - reservationId: string
      - tipo: string
      - client: Client
      - salon: Salon
      - payment: Payment
      - timeSlot: TimeSlot
    }
    class ReviewResponse {
      - id: number
      - author: string
      - rating: number
      - text: string
      - read: boolean
    }
  }
}

package "Dashboard" {

  package "Components" {
    ' Declaramos ReviewItemComponent y ReviewListComponent **solo como referencia** (no redeclarar)
    ' Para evitar duplicados referenciamos las del paquete appointments.components en relaciones

    class SalonItemComponent {
      - salon: Salon
      + salonSelected: EventEmitter<Salon>
    }

    class SalonListComponent {
      - salons: Salon[]
      + ngOnInit(): void
    }

    class StaffItemComponent {
      - worker: Worker
    }

    class StaffListComponent {
      - WorkerList: Worker[]
    }

    class UpcomingAppointmentsComponent {
      - upcomingAppointments: Appointment[]
      - appointmentService: AppointmentApiService
      - translate: TranslateService
      + ngOnInit(): void
      + formatTime(dateStr: string): string
      + formatDay(dateStr: string): string
      + isToday(dateStr: string): boolean
    }
  }

  package "Models" {
    entity Review {
      - id: number
      - author: string
      - rating: number
      - text: string
      - read: boolean
    }

    entity Salon {
      - salonId: string
      - location: string
      - imageURL: string
      - phone: number
      - name: string
    }

    entity Staff {
      ' atributos por definir
    }

    entity Worker {
      - id: number
      - nombre: string
      - especializacion: string
      - foto: string
    }

    entity Appointment {
      - reservationId: string
      - tipo: string
      - clientName: string
      - salonName: string
      - paymentStatus: boolean
      - timeSlotStart: string
      - timeSlotEnd: string
    }
  }

  package "Pages" {
    class ClientDashboardComponent {
    }

    class ProfessionalDashboardComponent {
      - worker: Worker[]
      - reviews: Review[]
      + ngOnInit(): void
    }

    class SalonComponent {
      - salon: Salon
      - profile: SalonProfile
      - reviews: Review[]
      - services: Service[]
      + ngOnInit(): void
      + salonSelected: EventEmitter<Salon>
    }
  }

  package "Services" {
    class ReviewApiService {
      - resourceEndpoint: string = "/reviews"
      + getReviews(): Observable<Review[]>
    }

    class SalonApiService {
      - baseUrl: string
      - detailsEndpoint: string = "/salons"
      + getSalons(): Observable<Salon[]>
    }

    class StaffApiService
    class AppointmentApiService {
      - resourceEndpoint: string = "/reservationDetails"
      + getAppointments(): Observable<Appointment[]>
    }

    class WorkerApiService {
      - resourceEndpoint: string = "/workers"
      + getWorkers(): Observable<Worker[]>
    }

    class ReviewAssembler {
      + toEntityFromResource(resource: ReviewResponse): Review
      + toEntitiesFromResponse(resources: ReviewResponse[]): Review[]
    }

    class SalonAssembler {
      + toEntityFromResource(resource: SalonsResource): Salon
      + toEntitiesfromResponse(response: SalonsResponse): Salon[]
    }

    class WorkerAssembler {
      + toEntityFromResource(resource: WorkerResource): Worker
      + toEntitiesFromResponse(resources: WorkerResource[]): Worker[]
    }

    class AppointmentAssembler {
      + toEntityFromResource(resource: AppointmentResponse): Appointment
      + toEntitiesFromResponse(resources: AppointmentResponse[]): Appointment[]
    }

    class ReviewResponse {
      - id: number
      - author: string
      - rating: number
      - text: string
      - read: boolean
    }

    class SalonsResource {
      - name: string
      - salonId: string
      - location: string
      - imageURL: string
      - phone: number
    }

    class WorkerResource {
      - workerId: number
      - nombre: string
      - especializacion: string
      - fotoUrl: string
    }

    class AppointmentResponse {
      - reservationId: string
      - tipo: string
      - client: Client
      - salon: Salon
      - payment: Payment
      - timeSlot: TimeSlot
      - worker: Worker
    }
  }
}

' Relaciones entre paquetes y clases usando nombre completo para evitar duplicados

Appointments.Components.AppointmentsListComponent --> Appointments.Components.AppointmentsItemComponent : composes
Appointments.Components.AppointmentsListComponent --> Appointments.Components.ReviewListComponent : composes
Appointments.Components.AppointmentsListComponent --> Appointments.Components.UpcomingAppointmentsComponent : composes

Appointments.Components.AppointmentsItemComponent --> Appointments.Models.ClientAppointment : uses
Appointments.Components.UpcomingAppointmentsComponent --> Appointments.Models.ClientAppointment : contains 0..*

Appointments.Components.ReviewItemComponent --> Appointments.Models.Review : uses
Appointments.Components.ReviewListComponent --> Appointments.Models.Review : contains 0..*
Appointments.Components.ReviewListComponent --> Appointments.Components.ReviewItemComponent : composes

Appointments.Components.UpcomingAppointmentsComponent --> Appointments.Services.AppointmentApiService : uses
Appointments.Components.AppointmentsListComponent --> Appointments.Services.AppointmentApiService : uses
Appointments.Components.AppointmentsListComponent --> Appointments.Services.ReviewApiService : uses

Dashboard.Pages.ProfessionalDashboardComponent --> Dashboard.Components.StaffListComponent : composes
Dashboard.Pages.ProfessionalDashboardComponent --> Dashboard.Components.UpcomingAppointmentsComponent : composes
Dashboard.Pages.ProfessionalDashboardComponent --> Appointments.Components.ReviewListComponent : composes
Dashboard.Pages.ProfessionalDashboardComponent --> Dashboard.Services.WorkerApiService : uses
Dashboard.Pages.ProfessionalDashboardComponent --> Dashboard.Services.ReviewApiService : uses

Dashboard.Pages.ClientDashboardComponent --> Dashboard.Components.UpcomingAppointmentsComponent : composes
Dashboard.Pages.ClientDashboardComponent --> Dashboard.Components.StaffListComponent : composes
Dashboard.Pages.ClientDashboardComponent --> Appointments.Components.ReviewListComponent : composes
Dashboard.Pages.ClientDashboardComponent --> Dashboard.Components.SalonListComponent : composes

Dashboard.Components.SalonComponent --> Dashboard.Models.Salon : uses
Dashboard.Components.SalonComponent --> Profile.Models.SalonProfile : uses
Dashboard.Components.SalonComponent --> Appointments.Models.Review : uses
Dashboard.Components.SalonComponent --> Dashboard.Services.ReviewApiService : uses
Dashboard.Components.SalonComponent --> Dashboard.Services.SalonApiService : uses
Dashboard.Components.SalonComponent --> Dashboard.Services.SalonProfileApiService : uses
Dashboard.Components.SalonComponent --> Dashboard.Services.ServiceApiService : uses
Dashboard.Components.SalonComponent --> Appointments.Components.ReviewListComponent : composes
Dashboard.Components.SalonComponent --> Services.Components.ServiceListComponent : composes

Appointments.Pages.AppointmentMakerComponent --> Dashboard.Services.WorkerApiService : uses
Appointments.Pages.AppointmentMakerComponent --> Appointments.Services.AppointmentApiService : uses
Appointments.Pages.AppointmentMakerComponent --> Dashboard.Components.StaffListComponent : composes
Appointments.Pages.AppointmentMakerComponent --> Schedule.Components.DatePickerComponent : composes
Appointments.Pages.AppointmentMakerComponent --> Appointments.Components.ReviewListComponent : composes
Appointments.Pages.AppointmentMakerComponent --> Services.Components.ServiceListComponent : composes

Appointments.Pages.ClientAppointmentPagesComponent --> Appointments.Components.AppointmentsListComponent : composes
Appointments.Pages.ClientAppointmentPagesComponent --> Dashboard.Components.SalonListComponent : composes
Appointments.Pages.ClientAppointmentPagesComponent --> Public.Components.SidebarClientComponent : composes
Appointments.Pages.ClientAppointmentPagesComponent --> Appointments.Components.UpcomingAppointmentsComponent : composes

Favorites.Pages.ClientFavoriteComponent --> Appointments.Components.UpcomingAppointmentsComponent : composes
Favorites.Pages.ClientFavoriteComponent --> Public.Components.SidebarClientComponent : composes
Favorites.Pages.ClientFavoriteComponent --> Dashboard.Components.SalonListComponent : composes
Favorites.Pages.ClientFavoriteComponent --> Favorites.Components.SalonGridComponent : composes

Public.Components.SidebarClientComponent --> Appointments.Components.UpcomingAppointmentsComponent : uses

Schedule.Components.CalendarComponent --> Dashboard.Models.Appointment : uses
Schedule.Components.CalendarComponent --> Dashboard.Services.AppointmentApiService : uses

Schedule.Pages.SchedulePageComponent --> Schedule.Components.CalendarComponent : composes
Schedule.Pages.SchedulePageComponent --> Public.Components.ToolbarProviderComponent : composes

Services.Pages.ServicesTabComponent --> Services.Services.ServiceApiService : uses
Services.Pages.ServicesTabComponent --> Services.Components.ServiceTableComponent : composes
Services.Components.ServiceTableComponent --> Services.Services.ServiceApiService : uses
Services.Components.ServiceTableComponent --> Services.Services.ServiceAssembler : uses
Services.Components.ServiceTableComponent --> Services.Models.Service : uses
Services.Components.ServiceListComponent --> Services.Services.ServiceApiService : uses
Services.Components.ServiceListComponent --> Services.Models.Service : uses
Services.Components.CreateServiceDialogComponent --> Services.Services.ServiceResponse : uses
Services.Services.ServiceApiService --> Services.Services.ServiceAssembler : uses
Services.Services.ServiceApiService --> Services.Services.ServiceResponse : uses

Shared.Services.BaseService <|-- Appointments.Services.AppointmentApiService
Shared.Services.BaseService <|-- Appointments.Services.ReviewApiService

Subscription.Pages.SubscriptionTabComponent --> Subscription.Components.SubscriptionPlanComponent : composes

package "Favorites" {

  package "Pages" {
    class ClientFavoriteComponent {
    }
  }

  package "Components" {
    class SalonGridComponent {
      - salons: Dashboard.Models.Salon[]
      + ngOnInit(): void
    }
  }
}

package "Iam" {
  package "Pages" {
    class RegisterPageComponent {
      - isProvider: boolean
      - showPlanSelector: boolean
      + toggleForm(isProvider: boolean): void
      + completeRegistration(): void
    }

    class LoginPage
  }

  package "Components" {
    class RegisterFormClientComponent
    class RegisterFormProviderComponent
    class PlanSelectorComponent {
      - selectedPlan: string
      + onPlanSelect(plan: string): void
    }
    class LoginFormComponent
  }

  ' Relaciones internas
  RegisterPageComponent --> Iam.Components.RegisterFormClientComponent : composes
  RegisterPageComponent --> Iam.Components.RegisterFormProviderComponent : composes
  RegisterPageComponent --> Iam.Components.PlanSelectorComponent : composes
  RegisterPageComponent --> Iam.Components.LoginFormComponent : composes
}

package "Profile" {

  package "Components" {
    class ProfileHeaderComponent {
      - profile: Profile.Models.SalonProfile
    }

    class ProfilePortfolioComponent {
      - profile: Profile.Models.SalonProfile
      + onAddPhoto(): void
      + onImageClick(imageUrl: string): void
    }

    class ReviewItemComponent {
      - review: Dashboard.Models.Review
    }

    class ReviewListComponent {
      - profileReviews: Dashboard.Models.Review[]
      + ngOnInit(): void
    }
  }

  package "Models" {
    class SalonProfile {
      - profileId: number
      - userId: string
      - salonName: string
      - rating: number
      - profileImage: string
      - coverImage: string
      - socials: socials
      - portfolioImages: string[]
      - address: string
      - email: string
      - accounts: accounts
    }
  }

  package "Pages" {
    class ProfilePageComponent {
      - profile: Profile.Models.SalonProfile
      + ngOnInit(): void
    }
  }

  package "Services" {
    class SalonProfileApiService {
      - resourceEndpoint: string = "/salonProfiles"
      + getProfileById(id: number): Observable<Profile.Models.SalonProfile>
    }

    class SalonProfileAssembler {
      + toEntityFromResponse(resource: SalonProfileResponse): Profile.Models.SalonProfile
      + toEntitiesFromResponse(resources: SalonProfileResponse[]): Profile.Models.SalonProfile[]
      + toResponseFromEntity(entity: Profile.Models.SalonProfile): SalonProfileResponse
    }

    class SalonProfileResponse {
      - id: number
      - userId: string
      - salonName: string
      - rating: number
      - profileImage: string
      - coverImage: string
      - socials: socials
      - portfolioImages: string[]
      - accounts: accounts
      - Address: string
      - salonemail: string
    }
  }
}

package "ProfileClient" {

  package "Components" {
    class ProfileComponent {
      - profileForm: FormGroup
      - passwordForm: FormGroup
      - profile: ProfileClient.Models.Profile
      - isLoading: boolean
      - passwordsMatch: boolean
      - showCurrentPasswordField: boolean
      + ngOnInit(): void
      + loadProfile(): void
      + updateForm(profile: ProfileClient.Models.Profile): void
      + saveProfile(): void
      + changePassword(): void
      + logout(): void
      + deleteAccount(): void
    }
  }

  package "Models" {
    entity Profile {
      - accountId: string
      - name: string
      - email: string
      - phoneNumber: string
      - identityDocument: string
      - notifications: boolean
      - location: boolean
    }
  }

  package "Pages" {
    class ClientProfileComponent {
    }
  }

  package "Services" {
    class ProfileService {
      - apiUrl: string
      + getProfile(): Observable<ProfileClient.Models.Profile>
      + updateProfile(profile: ProfileClient.Models.Profile): Observable<ProfileClient.Models.Profile>
      + changePassword(currentPassword: string, newPassword: string): Observable<boolean>
      + logout(): Observable<boolean>
      + deleteAccount(): Observable<boolean>
    }
  }
}

package "ProviderSettings" {

  package "Components" {
    class SettingsComponent {
      - profile: Profile.Models.SalonProfile
    }

    class SettingsPasswordComponent {
      - profile: Profile.Models.SalonProfile
      - value: string
      - currentPassword: string
      - passwordService: Profile.Services.SalonProfileApiService
      + updatePassword(): void
    }
  }

  package "Pages" {
    class SettingsPageComponent {
      - profile: Profile.Models.SalonProfile
      + ngOnInit(): void
    }
  }
}

' Relaciones internas ProviderSettings
ProviderSettings.Pages.SettingsPageComponent --> ProviderSettings.Components.SettingsComponent : composes
ProviderSettings.Pages.SettingsPageComponent --> ProviderSettings.Components.SettingsPasswordComponent : composes

' Relaciones externas ProviderSettings
ProviderSettings.Components.SettingsComponent --> Profile.Models.SalonProfile : uses
ProviderSettings.Components.SettingsPasswordComponent --> Profile.Models.SalonProfile : uses
ProviderSettings.Components.SettingsPasswordComponent --> Profile.Services.SalonProfileApiService : uses
ProviderSettings.Components.SettingsPasswordComponent --> Profile.Services.SalonProfileAssembler : uses
ProviderSettings.Pages.SettingsPageComponent --> Profile.Services.SalonProfileApiService : uses


package "Public" {

  package "Components" {
    class ClientLayoutComponent {
    }

    class LanguageSwitcherComponent {
      - currentLang: string
      - languages: string[]
      + useLanguage(language: string): void
    }

    class ProviderLayoutComponent {
    }

    class SidebarComponent {
    }

    class SidebarClientComponent {
    }

    class ToolbarClientComponent {
    }

    class ToolbarProviderComponent {
    }
  }
}

' Relaciones composición Public
Public.Components.ClientLayoutComponent --> Public.Components.SidebarComponent : composes
Public.Components.ClientLayoutComponent --> Public.Components.ToolbarProviderComponent : composes
Public.Components.ClientLayoutComponent --> Public.Components.SidebarClientComponent : composes
Public.Components.ClientLayoutComponent --> Public.Components.ToolbarClientComponent : composes

Public.Components.ProviderLayoutComponent --> Public.Components.SidebarComponent : composes
Public.Components.ProviderLayoutComponent --> Public.Components.ToolbarProviderComponent : composes

Public.Components.SidebarClientComponent --> Appointments.Components.UpcomingAppointmentsComponent : uses

Public.Components.ToolbarClientComponent --> Public.Components.LanguageSwitcherComponent : composes
Public.Components.ToolbarProviderComponent --> Public.Components.LanguageSwitcherComponent : composes


package "Reviews" {
  package "Pages" {
    class ReviewsTabComponent {
      - reviews: Dashboard.Models.Review[]
      + ngOnInit(): void
    }
  }
}

' Relaciones externas Reviews
Reviews.Pages.ReviewsTabComponent --> Dashboard.Components.ReviewListComponent : composes
Reviews.Pages.ReviewsTabComponent --> Dashboard.Services.ReviewApiService : uses
Reviews.Pages.ReviewsTabComponent --> Dashboard.Models.Review : uses


package "Schedule" {

  package "Components" {
    class CalendarComponent {
      - days: string[]
      - hours: string[]
      - workers: string[]
      - currentWorkerIndex: number
      - calendars: Dashboard.Models.Appointment[]
      + get currentWorker(): string
      + swapWorker(): void
      + ngOnInit(): void
      + formatTime(dateStr: string): string
      + formatDay(dateStr: string): string
      + isToday(dateStr: string): boolean
    }

    class DatePickerComponent {
      - selected: Date | null
      - timeSlots: array
      - selectedTimeSlot: any
      + selectTimeSlot(slot: any): void
      + reservationConfirmed: EventEmitter<{date: Date, timeSlot: any}>
    }

    class ReservationComponent {
      - service: string
      - startTime: string
      - endTime: string
      - clientName: string
    }
  }

  package "Pages" {
    class SchedulePageComponent {
    }
  }
}

' Relaciones Schedule
Schedule.Components.CalendarComponent --> Dashboard.Models.Appointment : uses
Schedule.Components.CalendarComponent --> Dashboard.Services.AppointmentApiService : uses

Schedule.Pages.SchedulePageComponent --> Schedule.Components.CalendarComponent : composes
Schedule.Pages.SchedulePageComponent --> Public.Components.ToolbarProviderComponent : composes


package "Services" {

  package "Components" {
    class CreateServiceDialogComponent {
      - service: Services.Models.ServiceResponse
      + submit(): void
      + cancel(): void
    }

    class ServiceListComponent {
      - services: Services.Models.Service[]
      + ngOnInit(): void
    }

    class ServiceTableComponent {
      - displayedColumns: string[]
      - services: Services.Models.Service[]
      - servicesService: Services.Services.ServiceApiService
      + createService(): void
      + updateService(): void
      + deleteService(id: number): void
    }
  }

  package "Models" {
    class Service {
      - id: number
      - name: string
      - description: string
      - duration: number
      - price: number
      - status: 'Active' | 'Paused'
    }
  }

  package "Services" {
    class ServiceApiService {
      - resourceEndpoint: string
      + getServices(): Observable<Services.Models.Service[]>
    }

    class ServiceAssembler {
      + toEntityFromResource(resource: Services.Services.ServiceResponse): Services.Models.Service
      + toEntitiesFromResponse(resources: Services.Services.ServiceResponse[]): Services.Models.Service[]
      + toResponseFromEntity(entity: Services.Models.Service): Services.Services.ServiceResponse
    }

    interface ServiceResponse {
      + id: number
      + name: string
      + description: string
      + duration: number
      + price: number
      + status: 'Active' | 'Paused'
    }
  }

  package "Pages" {
    class ServicesTabComponent {
      - service: Services.Models.Service[]
      + ngOnInit(): void
    }
  }
}

' Relaciones Services
Services.Pages.ServicesTabComponent --> Services.Services.ServiceApiService : uses
Services.Pages.ServicesTabComponent --> Services.Components.ServiceTableComponent : composes
Services.Components.ServiceTableComponent --> Services.Services.ServiceApiService : uses
Services.Components.ServiceTableComponent --> Services.Services.ServiceAssembler : uses
Services.Components.ServiceTableComponent --> Services.Models.Service : uses
Services.Components.ServiceListComponent --> Services.Services.ServiceApiService : uses
Services.Components.ServiceListComponent --> Services.Models.Service : uses
Services.Components.CreateServiceDialogComponent --> Services.Services.ServiceResponse : uses
Services.Services.ServiceApiService --> Services.Services.ServiceAssembler : uses
Services.Services.ServiceApiService --> Services.Services.ServiceResponse : uses


package "Shared" {

  package "Services" {
    abstract class BaseService<R> {
      - httpOptions: object
      - serverBaseUrl: string
      - resourceEndpoint: string
      - http: HttpClient
      - handleError(error: HttpErrorResponse): Observable<never>
      - resourcePath(): string
      + getAll(): Observable<R[]>
      + create(id: any, resource: R): Observable<R>
      + post(resource: R): Observable<R>
      + getById(id: any): Observable<R>
      + delete(id: any): Observable<any>
      + update(id: any, resource: R): Observable<R>
      + partialUpdate(id: any, partialResource: Partial<R>): Observable<R>
    }
  }
}

package "Subscription" {
  package "Pages" {
    class SubscriptionTabComponent {
    }
  }

  package "Components" {
    class SubscriptionPlanComponent {
      - selectedPlan: string
      + changePlan(plan: string): void
    }
  }
}

' Relaciones Subscription
Subscription.Pages.SubscriptionTabComponent --> Subscription.Components.SubscriptionPlanComponent : composes

@enduml
