<div class="profile-container">
  <div class="profile-header">
    <button mat-icon-button class="back-btn" routerLink="/client/homeClient">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1>{{'client.profile.profile' | translate}} <span>üíº</span></h1>
    <button mat-icon-button class="edit-profile-btn">
      <mat-icon>edit</mat-icon>
    </button>
  </div>

  <div class="profile-card" *ngIf="!isLoading">
    <section class="section">
      <h2>üë§ {{'client.profile.personal' | translate}} </h2>
      <form [formGroup]="profileForm" class="profile-form">
        <mat-form-field appearance="outline">
          <mat-label>{{'client.profile.name' | translate}} </mat-label>
          <input matInput formControlName="name">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>{{'client.profile.email' | translate}} </mat-label>
          <input matInput formControlName="email">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>{{'client.profile.phone' | translate}} </mat-label>
          <input matInput formControlName="phoneNumber">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>{{'client.profile.identity' | translate}} </mat-label>
          <input matInput formControlName="identityDocument">
        </mat-form-field>

        <div class="toggles">
          <mat-slide-toggle formControlName="notifications">
            <mat-icon>notifications</mat-icon> {{'client.profile.notifications' | translate}}
          </mat-slide-toggle>
          <mat-slide-toggle formControlName="location">
            <mat-icon>location_on</mat-icon> {{'client.profile.location' | translate}}
          </mat-slide-toggle>
        </div>
      </form>
    </section>

    <section class="section">
      <h2>üîê{{'client.profile.password' | translate}} </h2>
      <form [formGroup]="passwordForm">
        <div class="password-change">
          <ng-container *ngIf="!showCurrentPasswordField">
            <div class="password-hidden">
              ***********
              <button mat-stroked-button color="primary" (click)="showCurrentPasswordField = true">
                <mat-icon>edit</mat-icon> {{'client.profile.change' | translate}}
              </button>
            </div>
          </ng-container>

          <ng-container *ngIf="showCurrentPasswordField">
            <mat-form-field appearance="outline">
              <mat-label>Current Password</mat-label>
              <input matInput type="password" formControlName="currentPassword">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>New Password</mat-label>
              <input matInput type="password" formControlName="newPassword">
              <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('minlength')">
                Password must be at least 8 characters
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Confirm Password</mat-label>
              <input matInput type="password" formControlName="confirmPassword">
              <mat-error *ngIf="!passwordsMatch">
                Passwords do not match
              </mat-error>
            </mat-form-field>

            <div class="save-actions">
              <button mat-raised-button color="primary" [disabled]="passwordForm.invalid" (click)="changePassword()">
                <mat-icon>save</mat-icon> Save
              </button>
            </div>
          </ng-container>
        </div>
      </form>
    </section>

    <section class="section danger">
      <h2>‚ö†Ô∏è {{'client.profile.account' | translate}} </h2>
      <div class="account-actions">
        <button mat-stroked-button color="warn" (click)="logout()">
          <mat-icon>logout</mat-icon> {{'client.profile.logOut' | translate}}
        </button>
        <button mat-flat-button color="warn" (click)="deleteAccount()">
          <mat-icon>delete_forever</mat-icon> {{'client.profile.delete' | translate}}
        </button>
      </div>
    </section>
  </div>

  <div class="loading-spinner" *ngIf="isLoading">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
</div>
